version: '3.8'

services:
  api:
    build: .
    ports:
      - "3000:3000"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - SHARED_CONTEXT_API_SECRET=${SHARED_CONTEXT_API_SECRET}
    command: bun run src/api/index.ts

  nerve-center:
    build: .
    ports:
      - "3001:3001"
    environment:
      - SHARED_CONTEXT_API_URL=http://api:3000
      - SHARED_CONTEXT_API_SECRET=${SHARED_CONTEXT_API_SECRET}
    volumes:
       - ./history:/app/history
       - ./agent-instructions:/app/agent-instructions
    command: bun run src/local/server.ts
